# Работа с данными

## Где и как хранятся данные

- Все основные данные (пользователи, курсы, уроки, модули, прогресс, wishlist и т.д.) хранятся в базе данных PostgreSQL.
- Для хранения файлов (аватарки, изображения курсов и т.д.) используется S3-совместимое хранилище MinIO.

## Работа с базой данных

- Для взаимодействия с PostgreSQL используется ORM Drizzle.
- Схема БД описана в файле `drizzle/schema.ts`.
- Все изменения схемы оформляются через миграции (drizzle/000\*.sql).
- Для генерации и применения миграций используются npm-скрипты (`db:migrate`, `db:generate`, `db:push`).

## Работа с API

- Серверная часть реализована на Nuxt 3 (Nitro), все API-эндпоинты лежат в `server/api/`.
- Эндпоинты структурированы по сущностям (auth, users, courses, modules, lessons, wishlist и т.д.).
- Для валидации входящих данных используется Zod (серверные утилиты в `server/utils/zod.ts`).
- Для авторизации и аутентификации используется собственная логика на основе nuxt-auth-utils и middleware.

## Работа с файлами

- Загрузка и получение файлов реализованы через отдельные эндпоинты (`server/api/storage/`).
- Все файлы попадают в бакет MinIO, доступ к ним осуществляется по публичным ссылкам.

## Валидация и типизация

- Для валидации данных на сервере используется Zod.
- Для типизации на клиенте и сервере используется TypeScript.
- Типы для авторизации вынесены в отдельный файл `auth.d.ts`.

## Взаимодействие между слоями

- Клиентские страницы и компоненты обращаются к API через fetch (или useFetch в Nuxt).
- Серверные эндпоинты работают с БД через Drizzle ORM и возвращают данные в формате JSON.
- Все бизнес-правила и валидация реализованы на сервере, на клиенте — только базовая проверка форм.

---

Если потребуется добавить детали по конкретным сущностям или схемам — см. `drizzle/schema.ts` и документацию в папке context/.
